<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jogo da Tabuada • v5.1</title>
<style>
:root{
  --bg1:#7dd3fc; --bg2:#a7f3d0;
  --good:#10b981; --mid:#facc15; --bad:#ef4444;
}
body{
  margin:0;min-height:100vh;background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font:16px/1.4 'Poppins',sans-serif;display:flex;align-items:flex-start;justify-content:center;padding:16px;color:#0f172a;
}
.wrap{max-width:880px;width:100%}
header{display:flex;align-items:center;justify-content:center;gap:12px}
.badge{width:48px;height:48px;border-radius:14px;background:conic-gradient(from 180deg,#34d399,#60a5fa,#f472b6,#34d399);box-shadow:0 0 20px #34d39966}
h1{color:#fff;text-shadow:0 2px 12px #0005;margin:6px 0}
.sub{text-align:center;color:#e0f2fe;font-size:13px;margin:0 0 4px}
.sub2{text-align:center;color:#dbeafe;font-size:12px;font-style:italic;margin-bottom:12px}
.card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 6px 24px #0001}
.controls{display:flex;gap:10px;flex-wrap:wrap}
.control{flex:1 1 240px}
label{display:block;font-size:12px;margin-bottom:4px;color:#555}
select,button,input[type=number]{width:100%;border-radius:12px;padding:10px 12px;font-weight:600;border:2px solid #bae6fd;outline:none;font-size:14px;}
button{cursor:pointer;background:linear-gradient(180deg,#22c55e,#16a34a);color:#fff;font-weight:800;border:none;transition:transform .12s}
button:hover{transform:translateY(-1px)}button:active{transform:translateY(0)}
.secondary{background:linear-gradient(180deg,#60a5fa,#3b82f6)}
.actions{display:flex;gap:10px;margin-top:10px}
#game{display:none}
.board{display:flex;align-items:flex-end;justify-content:center;gap:8px;margin-top:8px}
.num{font-size:64px;font-weight:900}.eq{font-size:36px;padding:0 6px 4px}
.answerWrap{display:flex;flex-direction:column;align-items:center;margin-top:8px;position:relative}
#answer{max-width:160px;text-align:center;font-size:28px;font-weight:800}
#okBtn{width:160px;margin-top:8px}
.feedback{text-align:center;margin-top:10px;font-weight:800;font-size:18px}
.good{color:var(--good);animation:pop .35s}@keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
.bad{color:var(--bad);animation:shake .35s}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:8px}
.stat{background:#e0f2fe;border:1px solid #bfdbfe;border-radius:12px;padding:8px;text-align:center}
.stat h3{margin:0;font-size:12px;color:#0ea5e9}.stat p{margin:4px 0 0;font-size:18px;font-weight:800}

/* Barras */
.energy-bar{position:relative;height:16px;border-radius:10px;overflow:hidden;margin-top:10px;border:1px solid #94a3b8;box-shadow:inset 0 0 4px #0003}
.energy-fill{height:100%;width:0%;transition:width .4s ease;background:linear-gradient(270deg,var(--good),var(--mid),var(--bad));background-size:300% 100%;animation:flow 3s linear infinite;}
@keyframes flow{0%{background-position:0 0}100%{background-position:300% 0}}

/* Barra de níveis */
.meter{position:relative;margin-top:10px;border-radius:14px;overflow:hidden;border:1px solid #d1d5db;box-shadow:inset 0 0 6px #0002}
.meter .segments{display:grid;grid-template-columns:repeat(4,1fr);text-align:center}
.meter .seg{padding:6px 4px;font-weight:800;font-size:12px;color:#0f172a}
.seg1{background:#e5e7eb}.seg2{background:#bfdbfe}.seg3{background:#bbf7d0}.seg4{background:#fde68a}
.fill{position:absolute;top:0;left:0;height:100%;width:0%;background:linear-gradient(90deg,#3b82f6,#16a34a);opacity:.35;transition:width .4s ease,background .4s ease}

/* Painel final */
#finalPanel{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;z-index:10;animation:fadeIn .4s}
@keyframes fadeIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.final-box{background:linear-gradient(180deg,#fef9c3,#fde047);padding:24px;border-radius:20px;text-align:center;box-shadow:0 8px 24px #0002;max-width:400px;width:90%}
.final-box h2{margin:0 0 6px;font-size:26px}
.final-box p{margin:6px 0;font-weight:600}
#nextBtn{margin-top:12px;background:linear-gradient(180deg,#3b82f6,#2563eb);color:#fff;padding:10px 16px;border:none;border-radius:10px;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
<header><div class="badge"></div><h1>Jogo da Tabuada</h1></header>
<p class="sub">Treino divertido • 9–11 anos</p>
<p class="sub2">Emerson Alonso, pai do Miguel e do Gabriel</p>

<section class="card" id="setup">
<div class="controls">
  <div class="control"><label>Tabuada</label>
    <select id="tabuada">
      <option value="todas">Todas</option>
      <option>1</option><option>2</option><option>3</option>
      <option>4</option><option>5</option><option>6</option>
      <option>7</option><option>8</option><option>9</option><option>10</option>
    </select>
  </div>

  <div class="control"><label>Perguntas</label>
    <select id="qty">
      <option>10</option><option selected>20</option><option>30</option>
    </select>
  </div>

  <div class="control"><label>Modo</label>
    <select id="mode">
      <option value="memorizar" selected>Memorizar</option>
      <option value="aprender">Aprender</option>
    </select>
  </div>
</div>
<div class="actions"><button id="startBtn">Começar</button><button id="resetBtn" class="secondary" disabled>Reiniciar</button></div>
</section>

<section class="card" id="game">
  <div class="board"><div class="num" id="a">3</div><div class="eq">×</div><div class="num" id="b">4</div></div>
  <div class="answerWrap"><input id="answer" type="number" /><button id="okBtn">OK</button></div>
  <div class="feedback" id="feedback"></div>
  <div class="stats">
    <div class="stat"><h3>Questão</h3><p id="qIndex">0/0</p></div>
    <div class="stat"><h3>Acertos</h3><p id="hits">0</p></div>
    <div class="stat"><h3>%</h3><p id="pct">0%</p></div>
    <div class="stat"><h3>Tempo</h3><p id="avg">0.0s</p></div>
  </div>
  <div class="energy-bar"><div class="energy-fill" id="energy"></div></div>
  <div class="meter" id="meter"><div class="fill" id="meterFill"></div>
    <div class="segments">
      <div class="seg seg1">Explorador</div><div class="seg seg2">Ninja</div><div class="seg seg3">Mestre</div><div class="seg seg4">Lenda</div>
    </div>
  </div>
</section>
</div>

<script>
const aEl=document.getElementById('a'),bEl=document.getElementById('b'),ansEl=document.getElementById('answer');
const qIdxEl=document.getElementById('qIndex'),hitsEl=document.getElementById('hits'),pctEl=document.getElementById('pct'),avgEl=document.getElementById('avg'),fbEl=document.getElementById('feedback');
const startBtn=document.getElementById('startBtn'),resetBtn=document.getElementById('resetBtn'),okBtn=document.getElementById('okBtn');
const tabuadaEl=document.getElementById('tabuada'),qtyEl=document.getElementById('qty'),modeEl=document.getElementById('mode'),game=document.getElementById('game');
const meter=document.getElementById('meter'),fill=document.getElementById('meterFill'),energy=document.getElementById('energy');

const sndOK=new Audio("data:audio/wav;base64,UklGRpQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAAAgICAf39/f4CAgICAgICAf39/f4CAgICAf39/gICA");
const sndERR=new Audio("data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAAAgICAf39/gICAgICAgICAgH9/f4CAgICAf39/gICA");
const sndWIN=new Audio("data:audio/wav;base64,UklGRqIAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAAAgICAf39/f4CAgICAf39/gICAgICAgH9/f39/f4CAgICAgICAf39/f39/f4CA");
const sndBIP=new Audio("data:audio/wav;base64,UklGRkIAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAAAf39/gICA");
const sndBOP=new Audio("data:audio/wav;base64,UklGRkIAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAAAAgICAf39/");

let cfg={base:'todas',qty:20},questions=[],idx=0,totalMs=0,hits=0,prevLevel=0;
function rnd(lo,hi){return Math.floor(Math.random()*(hi-lo+1))+lo;}
function build(){questions=[];for(let i=0;i<cfg.qty;i++){const a=cfg.base==='todas'?rnd(1,10):parseInt(cfg.base,10);const b=rnd(1,10);questions.push({a,b,tStart:0,tEnd:0,correct:false});}}
function pctToWidth(p){if(p<=0)return 0;if(p<60)return(p/60)*25;if(p<75)return 25+((p-60)/15)*25;if(p<90)return 50+((p-75)/15)*25;const c=Math.min(p,100);return 75+((c-90)/10)*25;}
function levelFromPct(p){if(p<60)return 0;if(p<75)return 1;if(p<90)return 2;return 3;}
function colorFromPct(p){if(p<60)return 'linear-gradient(270deg,var(--bad),#f87171)';if(p<80)return'linear-gradient(270deg,var(--mid),#fde047)';return'linear-gradient(270deg,var(--good),#4ade80)';}

function updateEnergy(p){energy.style.width=Math.min(p,100)+'%';energy.style.background=colorFromPct(p);}
function animateEnergy(){energy.style.transform='translateX(2px)';setTimeout(()=>energy.style.transform='translateX(-2px)',500);setTimeout(animateEnergy,1000);}animateEnergy();

function updateMeter(p){const w=pctToWidth(p);fill.style.width=w+'%';const lvl=levelFromPct(p);if(lvl>prevLevel){meter.classList.add('glow');setTimeout(()=>meter.classList.remove('glow'),600);}prevLevel=lvl;}

function show(){
  if(idx>=questions.length){finish();return;}
  const q=questions[idx];
  aEl.textContent=q.a;
  bEl.textContent=q.b;
  q.tStart=performance.now();
  qIdxEl.textContent=`${idx+1}/${questions.length}`;
  ansEl.value='';
  ansEl.focus();
  fbEl.textContent='';

  // 👇 Modo Aprender: mostra o resultado em ghost (2 segundos)
  if(modeEl.value==='aprender'){
    ansEl.placeholder=''; // remove o ponto de interrogação
    const ghost=document.createElement('div');
    ghost.textContent=q.a*q.b;
    ghost.style.position='absolute';
    ghost.style.fontSize='32px';
    ghost.style.fontWeight='800';
    ghost.style.color='rgba(0,0,0,0.25)';
    ghost.style.pointerEvents='none';
    ghost.style.top='8px';
    ghost.style.left='0';
    ghost.style.right='0';
    ghost.style.textAlign='center';
    ansEl.parentNode.appendChild(ghost);
    setTimeout(()=>ghost.remove(),2000);
  } else {
    ansEl.placeholder='?';
  }
}

function stats(){const ans=Math.min(idx,questions.length);const pct=ans?Math.round((hits/ans)*100):0;const avg=ans?(totalMs/ans)/1000:0;hitsEl.textContent=hits;pctEl.textContent=pct+'%';avgEl.textContent=avg.toFixed(1)+'s';updateEnergy(pct);return{pct,avg};}

function classify(pct){if(pct<60)return{tier:'Explorador',msg:'Continue treinando, você está aprendendo!'};if(pct<75)return{tier:'Ninja',msg:'Você é rápido como um Ninja!'};if(pct<90)return{tier:'Mestre',msg:'Impressionante, você é um Mestre!'};return{tier:'Lenda',msg:'Incrível! Você é uma Lenda!'};}

function submit(){if(idx>=questions.length)return;const q=questions[idx];q.tEnd=performance.now();totalMs+=(q.tEnd-q.tStart);const val=Number(ansEl.value.trim());
  if(val===q.a*q.b){hits++;fbEl.textContent=`Correto! ${q.a}×${q.b}=${val}`;fbEl.className='feedback good';sndOK.play();sndBIP.play();}
  else{fbEl.textContent=`Ops… ${q.a}×${q.b}=${q.a*q.b}`;fbEl.className='feedback bad';sndERR.play();sndBOP.play();}
  idx++;const{pct}=stats();updateMeter(pct);setTimeout(show,600);
}

function start(){
  cfg.base=tabuadaEl.value;
  cfg.qty=parseInt(qtyEl.value,10);
  idx=0;totalMs=0;hits=0;prevLevel=0;
  build();
  game.style.display='block';
  resetBtn.disabled=false;
  startBtn.disabled=true;
  fill.style.width='0%';
  energy.style.width='0%';
  show();
}

function finish(){
  const{pct,avg}=stats();
  const{tier,msg}=classify(pct);
  const panel=document.createElement('div');
  panel.id='finalPanel';
  panel.innerHTML=`<div class='final-box'><h2>🏆 ${tier}</h2><p>${msg}</p><p>Acertos: ${pct}%<br>Tempo médio: ${avg.toFixed(1)}s</p><button id='nextBtn'>Próximo Game</button></div>`;
  document.body.appendChild(panel);
  sndWIN.play();
  document.getElementById('nextBtn').onclick=()=>{panel.remove();start();};
}

startBtn.onclick=start;
resetBtn.onclick=()=>{game.style.display='none';startBtn.disabled=false;resetBtn.disabled=true;fill.style.width='0%';energy.style.width='0%';};
okBtn.onclick=submit;
ansEl.addEventListener('keydown',e=>{if(e.key==='Enter')submit();});
</script>
</body>
</html>
